distros.tech {
  # HTTP -> HTTPS redirect (optional, Caddy does this automatically)

  # Proxy API requests to gateway (port 8000)
  route /api/* {
    reverse_proxy http://gateway:8000
  }

  # Proxy WebSocket connections at /ws to websocket-server (port 8080)
  @websocket {
    header Connection *Upgrade*
    header Upgrade websocket
    path /ws*
  }
  reverse_proxy @websocket websocket-server:8080 {
    transport http {
      versions h1 h2c
    }
  }

  # Proxy notify HTTP requests to websocket-server:8080
  route /notify {
    reverse_proxy websocket-server:8080
  }

  # Optional: you can serve a frontend here or proxy frontend elsewhere
  # For example, if frontend is static files:
  # root * /path/to/frontend/build
  # file_server
}
